## Vulnerable

### http://osdir.com/ml/bugtraq.security/2014-03/msg00067.html
> Versions Affected:
> - - Spring MVC 3.0.0 to 3.2.8
> - - Spring MVC 4.0.0 to 4.0.1
> - - Earlier unsupported versions may be affected
> Description:
> When a programmer does not specify the action on the Spring form, Spring automatically populates the action field with the requested uri. An atacker can use this to inject malicious content into the form.

### https://vuldb.com/?id.66721

> A vulnerability has been found in Springsource Spring Framework and classified as problematic. Affected by this vulnerability is an unknown function. The manipulation with an unknown input leads to a cross site scripting vulnerability. As an impact it is known to affect integrity.
> The weakness was released 03/20/2014. The advisory is shared for download at jira.springsource.org. This vulnerability is known as CVE-2014-1904. The attack can be launched remotely. The exploitation doesn't need any form of authentication. Neither technical details nor an exploit are publicly available.

### http://www.securityfocus.com/bid/66137/exploit

> To exploit this issue an attacker must entice an unsuspecting victim to open a malicious URI.

### Explaining
The requestUri is not encoded thus vulnerable, it is instantiated by [`resolveAction()`](https://github.com/spring-projects/spring-framework/blob/741b4b229ae032bd17175b46f98673ce0bd2d485/spring-webmvc/src/main/java/org/springframework/web/servlet/tags/form/FormTag.java#L430) method which return it.
`resolveAction()` is then invoked in [`writeTagContent()`](https://github.com/spring-projects/spring-framework/blob/741b4b229ae032bd17175b46f98673ce0bd2d485/spring-webmvc/src/main/java/org/springframework/web/servlet/tags/form/FormTag.java#L345) with

```java
tagWriter.writeAttribute(ACTION_ATTRIBUTE, resolveAction());
```

the tag is eventually [closed and asked to render](https://github.com/spring-projects/spring-framework/blob/bc14c5ba83e1f211628456bbccce7b2531aac58c/spring-webmvc/src/main/java/org/springframework/web/servlet/tags/form/FormTag.java#L483)

```java
this.tagWriter.endTag();
return EVAL_PAGE;
```

## Fixed

Fixed [with](https://github.com/spring-projects/spring-framework/commit/741b4b229ae032bd17175b46f98673ce0bd2d485) 

```java
String requestUri = getRequestContext().getRequestUri(); // Before there was only this line

// Added to fix the vuln
String encoding = pageContext.getResponse().getCharacterEncoding();
try {
	requestUri = UriUtils.encodePath(requestUri, encoding);
}
catch (UnsupportedEncodingException e) {
	throw new JspException(e);
}
```